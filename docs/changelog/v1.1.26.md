# v1.1.26：批量工具扩容、新增补丁工具

**发布日期**：2026年01月19日

---

## 一句话总结

Batch 工具限制从 10 提升到 25，新增 apply_patch 工具支持 OpenAI 模型，桌面端界面全面升级。

---

## 新功能：Batch 工具扩容

### 这次更新了什么？
批量操作工具（Batch tool）的最大调用次数从 10 提升到了 25。

### 什么是 Batch 工具？
Batch 工具允许 OpenCode 在一次请求中同时调用多个工具，比如同时读取多个文件或执行多个操作，大大提升效率。

### 这个更新有什么好处？
之前一次最多只能调用 10 个工具，现在可以一次性调用 25 个，处理大规模文件操作时更快更流畅。

---

## 新功能：OpenAI 模型支持补丁工具

### 这次更新了什么？
为 OpenAI 模型添加了 `apply_patch` 工具，使其能够更高效地应用代码补丁。

### 如何使用？
这个功能是自动启用的，当使用 OpenAI 模型时，OpenCode 会智能地决定是否使用补丁工具来修改代码，无需手动配置。

---

## 新功能：命令执行前置钩子

### 这次更新了什么？
新增了命令执行前置钩子（command execute before hook），允许在执行命令前运行自定义脚本。

### 如何使用？
在配置文件中设置：

```json
{
  "beforeExecute": "your-command-here"
}
```

这个钩子会在每次执行命令前自动运行，适用于自动化工作流。

---

## 新功能：Vim 风格滚动

### 这次更新了什么？
在 TUI 中添加了 Vim 风格的逐行滚动快捷键。

### 如何使用？
现在你可以使用 Vim 的快捷键逐行滚动：
- `Ctrl+E`：向下滚动一行
- `Ctrl+Y`：向上滚动一行

---

## 改进：桌面端界面全面升级

### 这次更新了什么？
桌面端界面进行了大量优化和改进：
- ✅ 更流畅的会话布局
- ✅ 更优雅的搜索框和命令面板
- ✅ 更好的项目编辑对话框
- ✅ 更智能的会话管理
- ✅ 新增会话取消分享功能

### 会话取消分享
现在你可以在桌面应用中取消已分享的会话：
1. 打开已分享的会话
2. 点击分享按钮
3. 选择取消分享

---

## 改进：TUI 交互升级

### 这次更新了什么？
- ✅ TUI 中可以使用鼠标操作权限按钮
- ✅ 修复 Windows 平台复制文本的问题
- ✅ 改进键盘和鼠标输入模式切换
- ✅ 支持 Home/End 键在菜单列表中导航

---

## 问题修复：多个 Bug 修复

### 修复的问题
- 修复了 Grok 模型的变体错误
- 修复了 Java 语言服务器在 Windows 上的下载问题
- 修复了 mDNS 主机名发现问题
- 修复了环境变量在配置中被替换的问题
- 修复了 Cargo 工作区格式化问题

---

## 要不要升级？

| 情况 | 建议 |
|------|------|
| 需要批量操作 | ✅ 强烈推荐，Batch 工具扩容 2.5 倍 |
| 使用 OpenAI 模型 | ✅ 推荐，新增补丁工具支持 |
| TUI 用户 | ✅ 推荐，交互体验升级 |
| 桌面应用用户 | ✅ 推荐，界面全面升级 |
| 稳定版本党 | ✅ 推荐，修复了多个 Bug |

**升级命令**：

```bash
opencode upgrade
```

---

## 技术细节（可跳过）

<details>
<summary>点击展开完整更新列表</summary>

**核心功能 (Core)**
- 将 Batch 工具最大限制从 10 提升到 25
- 移除应用中的 favicon
- 应用补丁描述
- 只格式化 Cargo 工作区中编辑的文件，而不是整个工作区
- 将 uv 格式化器从 'uv format' 重命名为 'uv' 以保持配置一致性
- 应用的初始端到端测试设置
- 将工作区重置为干净状态
- 删除工作区功能
- 微调 apply_patch 工具描述
- 为 OpenAI 模型省略 todo 工具
- 为 copilot 添加适当的变体支持
- 通过 output_index 跟踪推理以兼容 Copilot
- 在 GitHub Copilot 集成中自动将 GPT-5+ 模型路由到 Responses API
- 在使用 OpenAI OAuth 生成代理时使用 streamObject
- 修复 Grok 模型的错误变体
- 在审查文档中注明未跟踪的文件
- 将 .fbs 文件作为文本而不是图像处理
- 更新 GitLab AI 提供商到版本 1.3.2
- 添加命令执行前置钩子
- 彻底改进 Nix flake 和包
- 在会话重放期间保留文件附件元数据
- 更新 Scoop 安装方法
- 修复补丁模块中的导入问题
- 加载 ACP 会话时恢复持久化的模型和代理
- 在 ACP 中使用单个全局事件订阅并按会话 ID 路由
- 增加问题标题和标签限制
- 为 OpenAI 模型添加 apply_patch 工具
- 修复 Windows 上 Java 语言服务器下载
- 添加 vim 风格的逐行滚动键绑定
- 防止配置中的环境变量被实际值替换
- 修复 mDNS 主机名发现
- 恢复 MCP 服务器的 OAuth 重定向 URI 配置
- 修复 API 响应中的 GPT ID 处理
- 在 Copilot 设备认证中添加 OAuth 轮询安全边距

**TUI**
- 在 TUI 中阐明恢复会话提示
- 根据是使用鼠标还是键盘设置输入模式，以防止不必要的鼠标事件
- 不要不必要地换行并引入不必要的空行
- 为 TUI 中的权限按钮添加鼠标支持
- 修复 Windows 在复制时评估文本
- 卸载通过 Windows 包管理器安装的 OpenCode
- 统一命令注册表并从命令定义派生斜杠命令
- 当列表为空时隐藏变体提示
- 修复模型存储未准备好时的模型状态持久化
- 为 SSH 会话集中 OSC 52 剪贴板支持
- 子代理运行后保留主模型
- 使 home/end 键在菜单列表模式窗口中工作

**桌面端 (Desktop)**
- 修复应用中的 favicon
- 更改应用中循环思考投入的键绑定
- 修复全局终端和审查面板切换功能
- 修复应用中的基于哈希的导航
- 在尝试粘贴不支持的文件类型时提供反馈
- 将 favicon 重命名为 v2 以进行缓存清除
- 工作区重置后重新加载实例
- 使终端会话限定在工作区
- 在编辑对话框中向项目图标添加悬停叠加，带有上传和垃圾图标
- 收紧编辑项目颜色间距
- 限制编辑项目对话框宽度
- 微调编辑项目图标容器样式
- 调整编辑项目图标帮助文本
- 更新编辑项目对话框内边距和头像样式以保持一致
- 应用的新布局改进
- 新的会话布局
- 改进的会话布局
- 在应用中隐藏设置按钮
- 为应用添加更多端到端测试
- 添加应用程序的端到端测试实用程序
- 微调分享按钮以防止桌面布局移动
- 在桌面应用中的所有平台上应用 getComputedStyle polyfill
- 改进桌面会话搜索按钮的布局和样式
- 移除思考投入更改的冗余 toast
- 向桌面应用添加会话取消分享按钮
- 移除会话名称工具提示的最大宽度约束
- 调整项目路径工具提示放置
- 移除侧边栏新按钮的最大宽度
- 调整会话列表工具提示触发器和延迟
- 当弹出框打开时保留项目头像悬停样式
- 调整最近会话弹出框内边距
- 减少提示停靠底部间距
- 在头像悬停中显示项目名称
- 启动画面后移除加载文本
- 修复命令面板文件列表项间距
- 缩小项目通知点并应用遮罩
- 更新桌面初始化启动标志
- 对齐项目头像通知点
- 如果对话框已经打开，不要尝试打开命令面板
- 添加仅 Windows 保护，使 window.getComputedStyle 回退到 document.documentElement
- 修复不稳定的会话归档行为
- 防止搜索按钮下划线上的文本剪裁
- 从命令中移除次要文本
- 将搜索模态框最大高度限制为 480px
- 优化搜索模态框样式和列表组件
- 减少搜索模态框中的命令项左内边距
- 向 List 搜索添加 hideIcon 和 class 选项并自定义搜索模态框输入样式
- 调整搜索模态框中的命令项左内边距
- 向搜索模态框中的命令项添加左内边距
- 增加搜索模态框中键绑定边框半径
- 在键绑定格式中显示箭头键为符号
- 在搜索模态框列表中使用 Keybind 组件
- 在标题栏搜索按钮中使用 Keybind 组件
- 修复最近会话间距

**扩展**
- 向示例添加 use_github_token

**感谢 39 位社区贡献者**
</details>

---

[← 返回更新日志](./index.md)
